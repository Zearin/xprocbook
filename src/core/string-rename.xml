<refentry xmlns="http://docbook.org/ns/docbook"
          xmlns:cx="http://xmlcalabash.com/ns/extensions"
          xmlns:p="http://www.w3.org/ns/xproc"
          xml:id="p.string-replace">
<refnamediv>
<refname><step>p:string-replace</step></refname>
<refpurpose>Replaces matched nodes with the result of evaluating an XPath expression</refpurpose>
</refnamediv>

<refsynopsisdiv>
<p:declare-step type="p:string-replace">
   <p:input port="source"/>
   <p:output port="result"/>
   <p:option name="match" required="true" cx:type="XSLTMatchPattern"/>
   <p:option name="replace" required="true" cx:type="XPathExpression"/>
</p:declare-step>
</refsynopsisdiv>

<refsection>
<title>Description</title>

<para>The <step>p:string-replace</step> step replaces nodes in the
document provided on the <port>source</port> port that match the
pattern specified in the <option>match</option> option with the string
result of evaluating the XPath expression specified in the
<option>replace</option> option.</para>

<para>For each node in the document provided on the <port>source</port>
port:</para>

<itemizedlist>
<listiitem>
<para>If the match pattern specified in the <option>match</option> option
matches the node, then the XPath expression provided in the
<option>replace</option> option is evaluated with the current node
as the context.</para>
<para>If the node is an attribute node then the string value of the expression
replaces the attribute value, if the node is any other kind of node, then the
string value of the expression replaces the entire node (not just the
content of the node).</para>
</listiitem>
<listiitem>
<para>If the match pattern does not match the node, then the string replace
operation is performed on each of the node's attributes (if it is an element)
and its children. The resulting, transformed node is copied to the output.
</para>
</listiitem>
</itemizedlist>
</refsection>
</refentry>
